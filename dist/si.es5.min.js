"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.si={})})(void 0,function(a){"use strict";function b(){return k}function c(a){k.push(a)}function d(a){return n.get(a)}function e(a,b){var c=d(a);Array.isArray(c)?c.push(b):n.set(a,[b])}function f(a){return p.get(a)}function g(a,b){var c=f(a);Array.isArray(c)?c.push(b):p.set(a,[b])}function h(a,b){for(var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d=c.whatToShow,e=c.acceptNode,f={acceptNode:e||function(){return NodeFilter.FILTER_ACCEPT}},g=document.createTreeWalker(a,d||NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,f,!1),h=-1,i=!0,j=function(){return i=!1};g.nextNode()&&i;)h++,b(g.currentNode,h,j)}function i(a){var b=t.get(a);if(b instanceof u)return b;var c=new u(a);return t.set(a,c),c}var j=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"filter",value:function(){}},{key:"map",value:function(){}}]),a}(),k=[],l=function(){function a(){_classCallCheck(this,a),this.keys=[],this.values=[]}return _createClass(a,[{key:"set",value:function(a,b){this.keys.push(a),this.values.push(b)}},{key:"get",value:function(a){return this.values[this.keys.indexOf(a)]}},{key:"remove",value:function(a){var b=this.keys.indexOf(a);this.keys.splice(b,1),this.values.splice(b,1)}}]),a}(),m=function(){function a(b){_classCallCheck(this,a),this.nodeIndex=b}return _createClass(a,[{key:"filter",value:function(){}}]),a}(),n=new l,o=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"update",value:function(){}}],[{key:"filter",value:function(){}},{key:"map",value:function(){}}]),a}(),p=new l,q="__sijs_marker__",r="__sijs_placeholder__",s="__sijs_instance__",t=new l,u=function(){function a(c){_classCallCheck(this,a);var e=[],f=document.createElement("template");f.innerHTML=c.join(q);var g=[];h(f.content,function(a){if(-1!==a.nodeValue.indexOf(q)){var b=document.createDocumentFragment(),c=a.nodeValue.split(q).join(q+r+q).split(q).map(function(a){return document.createTextNode(a)}).forEach(function(a){b.appendChild(a)});g.push(function(){a.parentNode.replaceChild(b,a)})}},{whatToShow:NodeFilter.SHOW_TEXT,acceptNode:function(a){if(-1!==a.nodeValue.indexOf(q))return NodeFilter.FILTER_ACCEPT}}),g.forEach(function(a){return a()}),h(f.content,function(a,c){var f=b().find(function(b){return b.filter(a)});f&&f.prototype instanceof j&&f.map(a,c,function(){for(var a=arguments.length,b=Array(a),g=0;g<a;g++)b[g]=arguments[g];var h=d(f).find(function(a){return a.filter.apply(a,b)});h&&h.prototype instanceof m&&e.push(new(Function.prototype.bind.apply(h,[null].concat([c],b))))})}),this.templateElm=f,this.templateParts=e}return _createClass(a,[{key:"create",value:function(){var a=this,b=[],c=document.importNode(this.templateElm.content,!0),d=0,e=this.templateParts[d];return h(c,function(c,g,h){if(!e)return h();if(e.nodeIndex===g){var i=f(e.constructor).find(function(a){return a.filter(e)});i&&i.prototype instanceof o&&(b.push(new i(c,e)),e=a.templateParts[++d])}}),[].forEach(function(a){return a()}),new v(this,c.children.item(0),b)}}]),a}(),v=function(){function a(b,c,d){_classCallCheck(this,a),this.template=b,this.element=c,this.partUpdaters=d}return _createClass(a,[{key:"update",value:function(a){var b=0;this.partUpdaters.forEach(function(c){c.update(a.slice(b,b+=c.numberOfPart))})}}]),a}(),w=function(){function a(b,c){_classCallCheck(this,a),this.staticParts=b,this.dymanicParts=c}return _createClass(a,[{key:"verify",value:function(a){return t.get(this.staticParts)===a.template}},{key:"compile",value:function(){var a=i(this.staticParts).create();return a.element[s]=a,a.update(this.dymanicParts),a}},{key:"render",value:function(a){if(a[s]instanceof v&&this.verify(a[s])){var b=a[s];b.update(this.dymanicParts)}else{var c=this.compile();a.parentNode.replaceChild(c.element,a)}}}]),a}(),x=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(a){return a.nodeType===Node.ELEMENT_NODE&&a.hasAttributes()}},{key:"map",value:function(a,b,c){var d,e=!0,f=!1;try{for(var g,h,i=a.attributes[Symbol.iterator]();!(e=(g=i.next()).done);e=!0)h=g.value,c(h)}catch(a){f=!0,d=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw d}}}}]),b}(j),y=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(a){return a.nodeType===Node.TEXT_NODE&&a.nodeValue===r}},{key:"map",value:function(a,b,c){c()}}]),b}(j),z=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d.attributeName=c.name,d.staticParts=c.value.split(q),d}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(a){return-1!==a.value.indexOf(q)}}]),b}(m),A=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(){return!0}}]),b}(m),B=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(a){return a.name===q}}]),b}(m),C=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.node=a,d.attributeName=c.attributeName,d.staticParts=c.staticParts,d.oldValues=[],d.numberOfPart=staticParts.length-1,d}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(){return!0}}]),_createClass(b,[{key:"update",value:function(a){var b=this;if(-1!==a.findIndex(function(a,c){return a!==b.oldValues[c]})){var c=0,d=this.numberOfPart,e=this.staticParts.map(function(b,e){return e===d?b:b+a[c++]}).join("");this.node.setAttribute(this.attributeName,e),this.oldValues=a}}}]),b}(o),D=function(){function a(b,c){_classCallCheck(this,a),this.items=b,this.mapFn=c}return _createClass(a,[{key:"update",value:function(a,b,c){var d=c.parentNode;this.items.map(this.mapFn).forEach(function(b){var e=a.shift();if(e)b.render(e);else{var f=b.compile();d.insertBefore(f.element,c)}}),a.forEach(function(a){d.removeChild(a)})}}]),a}(),E=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return null==a.previousSibling&&a.parentNode.insertBefore(document.createTextNode(""),a),c.prevNode=a.previousSibling,c.nextNode=a.nextSibling,c.numberOfPart=1,c}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(){return!0}}]),_createClass(b,[{key:"update",value:function(a){var b=this.oldElements[0],c=a[0];c instanceof w?c.render(b):c instanceof D?c.update(this.oldElements,this.prevNode,this.nextNode):""+a!==this.oldElements[0].nodeValue&&(b.nodeValue=a)}},{key:"oldElements",get:function(){for(var a=this.prevNode.nextSibling,b=[];a!==this.nextNode;)b.push(a),a=a.nextSibling;return b}}]),b}(o),F=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return c.node=a,c.prevNode=a.previousSibling,c.nextNode=a.nextSibling,c.options={},c.numberOfPart=1,c}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(){return!0}}]),_createClass(b,[{key:"update",value:function(a){for(var b in a){var c=a[b];if("if"==b){if(c===this.options.if)continue;else c?c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[IFELSE]=!0):(this.nextNode.parentNode.removeChild(this.node),this.nextNode[IFELSE]=!1);this.options.if=c}else if("elseIf"==b){var d=this.prevNode[IFELSE];if(c===this.options.elseIf&&d===this.options.prevIf)continue;!c||d?(this.nextNode.parentNode.removeChild(this.node),this.nextNode[IFELSE]=d):c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[IFELSE]=!0),this.options.prevIf=d,this.options.elseIf=c}}}}]),b}(o),G=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.node=a,d.eventName=c.attributeName.slice(2),d.oldListener=null,d.numberOfPart=1,d.node.removeAttribute(c.attributeName),d}return _inherits(b,a),_createClass(b,null,[{key:"filter",value:function(a){return"on"===a.attributeName.slice(0,2)}}]),_createClass(b,[{key:"update",value:function(a){a=a[0],a===this.oldListener||(this.oldListener&&this.node.removeEventListener(this.eventName,this.oldListener),a&&this.node.addEventListener(this.eventName,a),this.oldListener=a)}}]),b}(o);c(x),c(y),e(x,z),e(x,B),e(y,A),g(z,G),g(z,C),g(A,E),g(B,F),a.html=function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return new w(a,c)},a.repeat=function(a,b){return new D(a,b)},Object.defineProperty(a,"__esModule",{value:!0})});
"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.si={})})(void 0,function(a){"use strict";function b(a,b){for(var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d=c.whatToShow,e=c.acceptNode,f={acceptNode:e||function(){return NodeFilter.FILTER_ACCEPT}},g=document.createTreeWalker(a,d||NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,f,!1),h=-1,i=!0,j=function(){console.log("TREEWALKER STOPED"),i=!1};g.nextNode()&&i;)h++,b(g.currentNode,h,j)}function c(a){var b=t.get(a);if(b instanceof u)return b;var c=new u(a);return t.set(a,c),c}var d="__sim__",e="__sip__",f="__sii__",g="__siie__",h=function(){function a(){_classCallCheck(this,a),this.keys=[],this.values=[]}return _createClass(a,[{key:"set",value:function(a,b){this.keys.push(a),this.values.push(b)}},{key:"get",value:function(a){return this.values[this.keys.indexOf(a)]}},{key:"remove",value:function(a){var b=this.keys.indexOf(a);this.keys.splice(b,1),this.values.splice(b,1)}}]),a}(),i=function a(b){_classCallCheck(this,a),this.nodeIndex=b},j=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return e.attributeName=c,e.staticParts=d,e}return _inherits(b,a),b}(i),k=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),b}(i),l=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d.eventName=c,d}return _inherits(b,a),b}(i),m=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),b}(i),n=function(){function a(){_classCallCheck(this,a),this.numberOfPart=1}return _createClass(a,[{key:"update",value:function(){}}]),a}(),o=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.attribute=a,d.staticParts=c,d.oldValues=[],d.numberOfPart=c.length-1,d}return _inherits(b,a),_createClass(b,[{key:"update",value:function(a){var b=this;if(-1!==a.findIndex(function(a,c){return a!==b.oldValues[c]})){var c=0,d=this.numberOfPart,e=this.staticParts.map(function(b,e){return e===d?b:b+a[c++]}).join("");this.attribute.value=e,this.oldValues=a}}}]),b}(n),p=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return c.node=a,c.prevNode=a.previousSibling,c.nextNode=a.nextSibling,c.options={},c}return _inherits(b,a),_createClass(b,[{key:"update",value:function(a){for(var b in a=a[0],a){var c=a[b];if("if"==b){if(c===this.options.if)continue;else c?c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[g]=!0):(this.nextNode.parentNode.removeChild(this.node),this.nextNode[g]=!1);this.options.if=c}else if("elseIf"==b){var d=this.prevNode[g];if(c===this.options.elseIf&&d===this.options.prevIf)continue;!c||d?(this.nextNode.parentNode.removeChild(this.node),this.nextNode[g]=d):c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[g]=!0),this.options.prevIf=d,this.options.elseIf=c}}}}]),b}(n),q=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.node=a,d.eventName=c,d.oldListener=null,a.removeAttribute("on"+c),d}return _inherits(b,a),_createClass(b,[{key:"update",value:function(a){a=a[0],a===this.oldListener||(this.oldListener&&this.node.removeEventListener(this.eventName,this.oldListener),a&&this.node.addEventListener(this.eventName,a),this.oldListener=a)}}]),b}(n),r=function(){function a(b,c){_classCallCheck(this,a),this.items=b,this.mapFn=c}return _createClass(a,[{key:"update",value:function(a,b,c){var d=c.parentNode;this.items.map(this.mapFn).forEach(function(b){var e=a.shift();if(e)b.render(e);else{var f=b.compile();d.insertBefore(f.element,c)}}),a.forEach(function(a){d.removeChild(a)})}}]),a}(),s=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return null==a.previousSibling&&a.parentNode.insertBefore(document.createTextNode(""),a),null==a.nextSibling&&a.parentNode.appendChild(document.createTextNode("")),c.prevNode=a.previousSibling,c.nextNode=a.nextSibling,c}return _inherits(b,a),_createClass(b,[{key:"update",value:function(a){var b=this.prevNode.nextSibling,c=a[0];c instanceof w?c.render(b):c instanceof r?c.update(this.oldElements,this.prevNode,this.nextNode):""+c!==this.oldElements[0].nodeValue&&(b.nodeValue=c)}},{key:"oldElements",get:function(){for(var a=this.prevNode.nextSibling,b=[];a!==this.nextNode;)b.push(a),a=a.nextSibling;return b}}]),b}(n),t=new h,u=function(){function a(c){_classCallCheck(this,a);var f=[],g=document.createElement("template");g.innerHTML=c.join(d);var h=[];b(g.content,function(a){for(var b=document.createDocumentFragment(),c=a.nodeValue.replace(/__sim__/g,d+e+d).split(d),f=c.length,g=0;g<f;g++)b.appendChild(document.createTextNode(c[g]));h.push(function(){a.parentNode.replaceChild(b,a)})},{whatToShow:NodeFilter.SHOW_TEXT,acceptNode:function(a){return-1===a.nodeValue.indexOf(d)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),h.forEach(function(a){return a()}),b(g.content,function(a,b){if(a.nodeType===Node.TEXT_NODE)return f.push(new m(b));for(var c,e=a.attributes.length,g=0;g<e;g++)c=a.attributes.item(g),c.name===d?f.push(new k(b)):"on"===c.name.slice(0,2)?f.push(new l(b,c.name.slice(2))):-1!==c.value.indexOf(d)&&f.push(new j(b,c.name,c.value.split(d)))},{acceptNode:function(a){return a.nodeType===Node.TEXT_NODE?a.nodeValue===e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:a.hasAttributes()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),this.templateElm=g,this.templateParts=f}return _createClass(a,[{key:"create",value:function(){var a=this,c=[],d=document.importNode(this.templateElm.content,!0);return b(d,function(b,d){a.templateParts.filter(function(a){return a.nodeIndex===d}).forEach(function(a){a instanceof m?c.push(new s(b)):a instanceof j?c.push(new o(b.attributes.getNamedItem(a.attributeName),a.staticParts)):a instanceof k?c.push(new p(b)):a instanceof l&&c.push(new q(b,a.eventName))})},{acceptNode:function(a){return a.nodeType===Node.TEXT_NODE?a.nodeValue===e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:a.hasAttributes()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),new v(this,d.children.item(0),c)}}]),a}(),v=function(){function a(b,c,d){_classCallCheck(this,a),this.template=b,this.element=c,this.partUpdaters=d}return _createClass(a,[{key:"update",value:function(a){var b=0;this.partUpdaters.forEach(function(c){c.update(a.slice(b,b+=c.numberOfPart))})}}]),a}(),w=function(){function a(b,c){_classCallCheck(this,a),this.staticParts=b,this.dymanicParts=c}return _createClass(a,[{key:"verify",value:function(a){return t.get(this.staticParts)===a.template}},{key:"compile",value:function(){var a=c(this.staticParts).create();return a.element[f]=a,a.update(this.dymanicParts),a}},{key:"render",value:function(a){if(a[f]instanceof v&&this.verify(a[f])){var b=a[f];b.update(this.dymanicParts)}else{var c=this.compile();a.parentNode.replaceChild(c.element,a)}}}]),a}();a.html=function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return new w(a,c)},a.repeat=function(a,b){return new r(a,b)},Object.defineProperty(a,"__esModule",{value:!0})});
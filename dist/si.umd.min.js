(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b(exports):'function'==typeof define&&define.amd?define(['exports'],b):b(a.si={})})(this,function(a){'use strict';function b(a,b,{whatToShow:c,acceptNode:d}={}){const e=document.createTreeWalker(a,c||NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:d||(()=>NodeFilter.FILTER_ACCEPT)},!1);let f=-1,g=!0;for(const h=()=>{console.log('TREEWALKER STOPED'),g=!1};e.nextNode()&&g;)f++,b(e.currentNode,f,h)}function c(a){const b=s.get(a);if(b instanceof t)return b;const c=new t(a);return s.set(a,c),c}const d='__sim__',e='__sip__',f='__sii__',g='__siie__';class h{constructor(a){this.nodeIndex=a}}class i extends h{constructor(a,b,c){super(a),this.attributeName=b,this.staticParts=c}}class j extends h{constructor(a){super(a)}}class k extends h{constructor(a,b){super(a),this.eventName=b}}class l extends h{constructor(a){super(a)}}class m{constructor(){this.numberOfPart=1}update(){}}class n extends m{constructor(a,b){super(),this.attribute=a,this.staticParts=b,this.oldValues=[],this.numberOfPart=b.length-1}update(a){if(-1===a.findIndex((a,b)=>a!==this.oldValues[b]))return;let b=0;const c=this.numberOfPart,d=this.staticParts.map((d,e)=>e===c?d:d+a[b++]).join('');this.attribute.value=d,this.oldValues=a}}class o extends m{constructor(a){super(),this.node=a,this.prevNode=a.previousSibling,this.nextNode=a.nextSibling,this.options={}}update(a){for(const b in a=a[0],a){const c=a[b];if('if'==b){if(c===this.options.if)continue;else c?c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[g]=!0):(this.nextNode.parentNode.removeChild(this.node),this.nextNode[g]=!1);this.options.if=c}else if('elseIf'==b){const a=this.prevNode[g];if(c===this.options.elseIf&&a===this.options.prevIf)continue;!c||a?(this.nextNode.parentNode.removeChild(this.node),this.nextNode[g]=a):c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[g]=!0),this.options.prevIf=a,this.options.elseIf=c}}}}class p extends m{constructor(a,b){super(),this.node=a,this.eventName=b,this.oldListener=null,a.removeAttribute('on'+b)}update(a){a=a[0];a===this.oldListener||(this.oldListener&&this.node.removeEventListener(this.eventName,this.oldListener),a&&this.node.addEventListener(this.eventName,a),this.oldListener=a)}}class q{constructor(a,b){this.items=a,this.mapFn=b}update(a,b,c){const d=c.parentNode;this.items.map(this.mapFn).forEach((b)=>{const e=a.shift();if(e)b.render(e);else{const a=b.compile();d.insertBefore(a.element,c)}}),a.forEach((a)=>{d.removeChild(a)})}}class r extends m{constructor(a){super(),null==a.previousSibling&&a.parentNode.insertBefore(document.createTextNode(''),a),null==a.nextSibling&&a.parentNode.appendChild(document.createTextNode('')),this.prevNode=a.previousSibling,this.nextNode=a.nextSibling}get oldElements(){let a=this.prevNode.nextSibling;const b=[];for(;a!==this.nextNode;)b.push(a),a=a.nextSibling;return b}update(a){const b=this.prevNode.nextSibling,c=a[0];c instanceof v?c.render(b):c instanceof q?c.update(this.oldElements,this.prevNode,this.nextNode):''+c!==this.oldElements[0].nodeValue&&(b.nodeValue=c)}}const s=new class{constructor(){this.keys=[],this.values=[]}set(a,b){this.keys.push(a),this.values.push(b)}get(a){return this.values[this.keys.indexOf(a)]}remove(a){const b=this.keys.indexOf(a);this.keys.splice(b,1),this.values.splice(b,1)}};class t{constructor(a){const c=[],f=document.createElement('template');f.innerHTML=a.join(d);let g=[];b(f.content,(a)=>{const b=document.createDocumentFragment(),c=a.nodeValue.replace(/__sim__/g,d+e+d).split(d),f=c.length;for(let d=0;d<f;d++)b.appendChild(document.createTextNode(c[d]));g.push(()=>{a.parentNode.replaceChild(b,a)})},{whatToShow:NodeFilter.SHOW_TEXT,acceptNode(a){return-1===a.nodeValue.indexOf(d)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),g.forEach((a)=>a()),b(f.content,(a,b)=>{if(a.nodeType===Node.TEXT_NODE)return c.push(new l(b));const e=a.attributes.length;for(let f=0;f<e;f++){const e=a.attributes.item(f);e.name===d?c.push(new j(b)):'on'===e.name.slice(0,2)?c.push(new k(b,e.name.slice(2))):-1!==e.value.indexOf(d)&&c.push(new i(b,e.name,e.value.split(d)))}},{acceptNode(a){return a.nodeType===Node.TEXT_NODE?a.nodeValue===e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:a.hasAttributes()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),this.templateElm=f,this.templateParts=c}create(){const a=[],c=document.importNode(this.templateElm.content,!0);return b(c,(b,c)=>{this.templateParts.filter((a)=>a.nodeIndex===c).forEach((c)=>{c instanceof l?a.push(new r(b)):c instanceof i?a.push(new n(b.attributes.getNamedItem(c.attributeName),c.staticParts)):c instanceof j?a.push(new o(b)):c instanceof k&&a.push(new p(b,c.eventName))})},{acceptNode(a){return a.nodeType===Node.TEXT_NODE?a.nodeValue===e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:a.hasAttributes()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),new u(this,c.children.item(0),a)}}class u{constructor(a,b,c){this.template=a,this.element=b,this.partUpdaters=c}update(a){let b=0;this.partUpdaters.forEach((c)=>{c.update(a.slice(b,b+=c.numberOfPart))})}}class v{constructor(a,b){this.staticParts=a,this.dymanicParts=b}verify(a){return s.get(this.staticParts)===a.template}compile(){const a=c(this.staticParts).create();return a.element[f]=a,a.update(this.dymanicParts),a}render(a){if(a[f]instanceof u&&this.verify(a[f])){const b=a[f];b.update(this.dymanicParts)}else{const b=this.compile();a.parentNode.replaceChild(b.element,a)}}}a.html=function(a,...b){return new v(a,b)},a.repeat=function(a,b){return new q(a,b)},Object.defineProperty(a,'__esModule',{value:!0})});
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b(exports):'function'==typeof define&&define.amd?define(['exports'],b):b(a.si={})})(this,function(a){'use strict';function b(){return k}function c(a){k.push(a)}function d(a){return n.get(a)}function e(a,b){const c=d(a);Array.isArray(c)?c.push(b):n.set(a,[b])}function f(a){return p.get(a)}function g(a,b){const c=f(a);Array.isArray(c)?c.push(b):p.set(a,[b])}function h(a,b,{whatToShow:c,acceptNode:d}={}){const e=document.createTreeWalker(a,c||NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:d||(()=>NodeFilter.FILTER_ACCEPT)},!1);let f=-1,g=!0;for(const h=()=>g=!1;e.nextNode()&&g;)f++,b(e.currentNode,f,h)}function i(a){const b=t.get(a);if(b instanceof u)return b;const c=new u(a);return t.set(a,c),c}class j{static filter(){}static map(){}}const k=[];class l{constructor(){this.keys=[],this.values=[]}set(a,b){this.keys.push(a),this.values.push(b)}get(a){return this.values[this.keys.indexOf(a)]}remove(a){const b=this.keys.indexOf(a);this.keys.splice(b,1),this.values.splice(b,1)}}class m{filter(){}constructor(a){this.nodeIndex=a}}const n=new l;class o{static filter(){}static map(){}update(){}}const p=new l,q='__sijs_marker__',r='__sijs_placeholder__',s='__sijs_instance__',t=new l;class u{constructor(a){const c=[],e=document.createElement('template');e.innerHTML=a.join(q);const f=[];h(e.content,(a)=>{if(-1===a.nodeValue.indexOf(q))return;const b=document.createDocumentFragment(),c=a.nodeValue.split(q).join(q+r+q).split(q).map((a)=>document.createTextNode(a)).forEach((a)=>{b.appendChild(a)});f.push(()=>{a.parentNode.replaceChild(b,a)})},{whatToShow:NodeFilter.SHOW_TEXT,acceptNode(a){if(-1!==a.nodeValue.indexOf(q))return NodeFilter.FILTER_ACCEPT}}),f.forEach((a)=>a()),h(e.content,(a,e)=>{const f=b().find((b)=>b.filter(a));f&&f.prototype instanceof j&&f.map(a,e,(...a)=>{const b=d(f).find((b)=>b.filter(...a));b&&b.prototype instanceof m&&c.push(new b(e,...a))})}),this.templateElm=e,this.templateParts=c}create(){const a=[],b=document.importNode(this.templateElm.content,!0);let c=0,d=this.templateParts[c];return h(b,(b,e,g)=>{if(!d)return g();if(d.nodeIndex===e){const e=f(d.constructor).find((a)=>a.filter(d));e&&e.prototype instanceof o&&(a.push(new e(b,d)),d=this.templateParts[++c])}}),[].forEach((a)=>a()),new v(this,b.children.item(0),a)}}class v{constructor(a,b,c){this.template=a,this.element=b,this.partUpdaters=c}update(a){let b=0;this.partUpdaters.forEach((c)=>{c.update(a.slice(b,b+=c.numberOfPart))})}}class w{constructor(a,b){this.staticParts=a,this.dymanicParts=b}verify(a){return t.get(this.staticParts)===a.template}compile(){const a=i(this.staticParts).create();return a.element[s]=a,a.update(this.dymanicParts),a}render(a){if(a[s]instanceof v&&this.verify(a[s])){const b=a[s];b.update(this.dymanicParts)}else{const b=this.compile();a.parentNode.replaceChild(b.element,a)}}}class x extends j{static filter(a){return a.nodeType===Node.ELEMENT_NODE&&a.hasAttributes()}static map(a,b,c){for(const d of a.attributes)c(d)}}class y extends j{static filter(a){return a.nodeType===Node.TEXT_NODE&&a.nodeValue===r}static map(a,b,c){c()}}class z extends m{static filter(a){return-1!==a.value.indexOf(q)}constructor(a,b){super(a),this.attributeName=b.name,this.staticParts=b.value.split(q)}}class A extends m{static filter(){return!0}constructor(a){super(a)}}class B extends m{static filter(a){return a.name===q}constructor(a){super(a)}}class C{constructor(a,b){this.items=a,this.mapFn=b}update(a,b,c){const d=c.parentNode;this.items.map(this.mapFn).forEach((b)=>{const e=a.shift();if(e)b.render(e);else{const a=b.compile();d.insertBefore(a.element,c)}}),a.forEach((a)=>{d.removeChild(a)})}}class D extends o{static filter(){return!0}constructor(a){super(),null==a.previousSibling&&a.parentNode.insertBefore(document.createTextNode(''),a),this.prevNode=a.previousSibling,this.nextNode=a.nextSibling,this.numberOfPart=1}get oldElements(){let a=this.prevNode.nextSibling;const b=[];for(;a!==this.nextNode;)b.push(a),a=a.nextSibling;return b}update(a){const b=this.oldElements[0],c=a[0];c instanceof w?c.render(b):c instanceof C?c.update(this.oldElements,this.prevNode,this.nextNode):''+a!==this.oldElements[0].nodeValue&&(b.nodeValue=a)}}c(x),c(y),e(x,z),e(x,B),e(y,A),g(z,class extends o{static filter(a){return'on'===a.attributeName.slice(0,2)}constructor(a,b){super(),this.node=a,this.eventName=b.attributeName.slice(2),this.oldListener=null,this.numberOfPart=1,this.node.removeAttribute(b.attributeName)}update(a){a=a[0];a===this.oldListener||(this.oldListener&&this.node.removeEventListener(this.eventName,this.oldListener),a&&this.node.addEventListener(this.eventName,a),this.oldListener=a)}}),g(z,class extends o{static filter(){return!0}constructor(a,b){super(),this.node=a,this.attributeName=b.attributeName,this.staticParts=b.staticParts,this.oldValues=[],this.numberOfPart=staticParts.length-1}update(a){if(-1===a.findIndex((a,b)=>a!==this.oldValues[b]))return;let b=0;const c=this.numberOfPart,d=this.staticParts.map((d,e)=>e===c?d:d+a[b++]).join('');this.node.setAttribute(this.attributeName,d),this.oldValues=a}}),g(A,D),g(B,class extends o{static filter(){return!0}constructor(a){super(),this.node=a,this.prevNode=a.previousSibling,this.nextNode=a.nextSibling,this.options={},this.numberOfPart=1}update(a){for(const b in a){const c=a[b];if('if'==b){if(c===this.options.if)continue;else c?c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[IFELSE]=!0):(this.nextNode.parentNode.removeChild(this.node),this.nextNode[IFELSE]=!1);this.options.if=c}else if('elseIf'==b){const a=this.prevNode[IFELSE];if(c===this.options.elseIf&&a===this.options.prevIf)continue;!c||a?(this.nextNode.parentNode.removeChild(this.node),this.nextNode[IFELSE]=a):c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[IFELSE]=!0),this.options.prevIf=a,this.options.elseIf=c}}}}),a.html=function(a,...b){return new w(a,b)},a.repeat=function(a,b){return new C(a,b)},Object.defineProperty(a,'__esModule',{value:!0})});
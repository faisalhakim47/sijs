const MARKER='__sim__',PLACEHOLDER='__sip__',INSTANCE='__sii__',IFELSE='__siie__';function walkDomTree(a,b,{whatToShow:c,acceptNode:d}={}){const e=document.createTreeWalker(a,c||NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:d||(()=>NodeFilter.FILTER_ACCEPT)},!1);let f=-1,g=!0;for(const h=()=>g=!1;e.nextNode()&&g;)f++,b(e.currentNode,f,h)}class List{constructor(){this.keys=[],this.values=[]}set(a,b){this.keys.push(a),this.values.push(b)}get(a){return this.values[this.keys.indexOf(a)]}remove(a){const b=this.keys.indexOf(a);this.keys.splice(b,1),this.values.splice(b,1)}}class Expression{constructor(a){this.nodeIndex=a}}class AttributeExpression extends Expression{constructor(a,b,c){super(a),this.attributeName=b,this.staticParts=c}}class ElementExpression extends Expression{constructor(a){super(a)}}class EventExpression extends Expression{constructor(a,b){super(a),this.eventName=b}}class ContentExpression extends Expression{constructor(a){super(a)}}class Updater{constructor(){this.numberOfPart=1}update(){}}class AttributeUpdater extends Updater{constructor(a,b){super(),this.attribute=a,this.staticParts=b,this.oldValues=[],this.numberOfPart=b.length-1}update(a){if(-1===a.findIndex((a,b)=>a!==this.oldValues[b]))return;let b=0;const c=this.numberOfPart,d=this.staticParts.map((d,e)=>e===c?d:d+a[b++]).join('');this.attribute.value=d,this.oldValues=a}}class ElementUpdater extends Updater{constructor(a){super(),this.node=a,this.prevNode=a.previousSibling,this.nextNode=a.nextSibling,this.options={}}update(a){for(const b in a=a[0],a){const c=a[b];if('if'==b){if(c===this.options.if)continue;else c?c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[IFELSE]=!0):(this.nextNode.parentNode.removeChild(this.node),this.nextNode[IFELSE]=!1);this.options.if=c}else if('elseIf'==b){const a=this.prevNode[IFELSE];if(c===this.options.elseIf&&a===this.options.prevIf)continue;!c||a?(this.nextNode.parentNode.removeChild(this.node),this.nextNode[IFELSE]=a):c&&(this.nextNode.parentNode.insertBefore(this.node,this.nextNode),this.nextNode[IFELSE]=!0),this.options.prevIf=a,this.options.elseIf=c}}}}class EventUpdater extends Updater{constructor(a,b){super(),this.node=a,this.eventName=b,this.oldListener=null,a.removeAttribute('on'+b)}update(a){a=a[0];a===this.oldListener||(this.oldListener&&this.node.removeEventListener(this.eventName,this.oldListener),a&&this.node.addEventListener(this.eventName,a),this.oldListener=a)}}function repeat(a,b){return new Repeat(a,b)}class Repeat{constructor(a,b){this.items=a,this.mapFn=b}update(a,b,c){const d=c.parentNode;this.items.map(this.mapFn).forEach((b)=>{const e=a.shift();if(e)b.render(e);else{const a=b.compile();d.insertBefore(a.element,c)}}),a.forEach((a)=>{d.removeChild(a)})}}class ContentUpdater extends Updater{constructor(a){super(),null==a.previousSibling&&a.parentNode.insertBefore(document.createTextNode(''),a),null==a.nextSibling&&a.parentNode.appendChild(document.createTextNode('')),this.prevNode=a.previousSibling,this.nextNode=a.nextSibling}get oldElements(){let a=this.prevNode.nextSibling;const b=[];for(;a!==this.nextNode;)b.push(a),a=a.nextSibling;return b}update(a){const b=this.prevNode.nextSibling,c=a[0];c instanceof LitTag?c.render(b):c instanceof Repeat?c.update(this.oldElements,this.prevNode,this.nextNode):''+c!==this.oldElements[0].nodeValue&&(b.nodeValue=c)}}const templateCache=new List;function requestTemplate(a){const b=templateCache.get(a);if(b instanceof Template)return b;const c=new Template(a);return templateCache.set(a,c),c}class Template{constructor(a){const b=[],c=document.createElement('template');c.innerHTML=a.join(MARKER);let d=[];walkDomTree(c.content,(a)=>{const b=document.createDocumentFragment(),c=a.nodeValue.replace(/__sim__/g,MARKER+PLACEHOLDER+MARKER).split(MARKER),e=c.length;for(let d=0;d<e;d++)b.appendChild(document.createTextNode(c[d]));d.push(()=>{a.parentNode.replaceChild(b,a)})},{whatToShow:NodeFilter.SHOW_TEXT,acceptNode(a){return-1===a.nodeValue.indexOf(MARKER)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),d.forEach((a)=>a()),walkDomTree(c.content,(a,c)=>{if(a.nodeType===Node.TEXT_NODE)return b.push(new ContentExpression(c));const d=a.attributes.length;for(let e=0;e<d;e++){const d=a.attributes.item(e);d.name===MARKER?b.push(new ElementExpression(c)):'on'===d.name.slice(0,2)?b.push(new EventExpression(c,d.name.slice(2))):-1!==d.value.indexOf(MARKER)&&b.push(new AttributeExpression(c,d.name,d.value.split(MARKER)))}},{acceptNode(a){return a.nodeType===Node.TEXT_NODE?a.nodeValue===PLACEHOLDER?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:a.hasAttributes()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),this.templateElm=c,this.templateParts=b}create(){const a=[],b=document.importNode(this.templateElm.content,!0);return walkDomTree(b,(b,c)=>{this.templateParts.filter((a)=>a.nodeIndex===c).forEach((c)=>{c instanceof ContentExpression?a.push(new ContentUpdater(b)):c instanceof AttributeExpression?a.push(new AttributeUpdater(b.attributes.getNamedItem(c.attributeName),c.staticParts)):c instanceof ElementExpression?a.push(new ElementUpdater(b)):c instanceof EventExpression&&a.push(new EventUpdater(b,c.eventName))})},{acceptNode(a){return a.nodeType===Node.TEXT_NODE?a.nodeValue===PLACEHOLDER?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:a.hasAttributes()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}),new TemplateInstance(this,b.children.item(0),a)}}class TemplateInstance{constructor(a,b,c){this.template=a,this.element=b,this.partUpdaters=c}update(a){let b=0;this.partUpdaters.forEach((c)=>{c.update(a.slice(b,b+=c.numberOfPart))})}}class LitTag{constructor(a,b){this.staticParts=a,this.dymanicParts=b}verify(a){return templateCache.get(this.staticParts)===a.template}compile(){const a=requestTemplate(this.staticParts).create();return a.element[INSTANCE]=a,a.update(this.dymanicParts),a}render(a){if(a[INSTANCE]instanceof TemplateInstance&&this.verify(a[INSTANCE])){const b=a[INSTANCE];b.update(this.dymanicParts)}else{const b=this.compile();a.parentNode.replaceChild(b.element,a)}}}function html(a,...b){return new LitTag(a,b)}export{html,repeat};